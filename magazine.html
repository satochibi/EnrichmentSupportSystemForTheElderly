<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高齢者のお困り解決砥部町内サービスサイト</title>
    <link rel="stylesheet" href="./css/normalize.css">
    <link rel="stylesheet" href="./css/obento.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>

<body>
    <div class="container">
        <header>
            <h1><a href="./index.html">高齢者の<span>お困り解決</span>サイト<br>(砥部町内サービス)</a></h1>
            <a href="./shopping-cart.html" class="shopping-cart-button"><i class="fas fa-shopping-cart"></i>カゴ</a>
        </header>


        <div class="breadcrumb-list">
            <ul>
                <li><a href="./index.html">HOME</a></li>
                <li><a href="#">雑誌</a></li>
            </ul>
        </div>

        <div class="main-contents">
            <h2>雑誌の宅配サービス</h2>

            <div id="search">
                <form action="">
                    <h3>商品検索</h3>
                    <div class="input-container">
                        <div class="input-field">
                            <input name="item-name" type="text" placeholder="商品名を検索できます">
                        </div>
                    </div>
                    <div class="button-field">
                        <input type="submit" value="検索">
                    </div>
                </form>
            </div>

            <div id="order">
                <form action="">
                    <h3>書籍購入の申込</h3>
                    <div class="input-container">
                        <div class="input-field">
                            <label for="name">お名前</label>
                            <input type="text" name="name" placeholder="砥部 花子">
                        </div>
                        <div class="input-field">
                            <label for="phone-number">電話番号</label>
                            <input type="text" name="phone-number" placeholder="089-982-0001"
                                pattern="\d{2,4}-?\d{2,4}-?\d{3,4}">
                        </div>
                    </div>
                    <div class="button-field">
                        <input type="submit" value="申込">
                    </div>
                </form>
            </div>

            <div class="shopping-table">
                <!-- <div class="item-cell">
                    <div class="item-header">
                        <h3>店舗あいうえお</h3>
                        <span>本屋</span>
                    </div>

                    <div class="item-body">
                        <img src="img/zasshi.jpg" alt="あ雑誌">
                        <h4>あ雑誌</h4>
                        <hr>
                        <form>
                            <div class="clearfix menu-list">
                                <label for="large">500円<span class="tax-text">(税込)</span></label>
                                <select id="large" name="large">
                                    <option value="one">1冊</option>
                                    <option value="two">2冊</option>
                                    <option value="three">3冊</option>
                                    <option value="four">4冊</option>
                                    <option value="five">5冊</option>
                                    <option value="six">6冊</option>
                                    <option value="seven">7冊</option>
                                    <option value="eight">8冊</option>
                                    <option value="nine">9冊</option>
                                    <option value="ten">10冊</option>
                                </select>
                            </div>

                            <div class="detail">
                                つれづれなるまゝに、日暮らし、硯にむかひて、心にうつりゆくよしなし事を、
                                そこはかとなく書きつくれば、あやしうこそものぐるほしけれ。（Wikipediaより）
                                つれづれなるまゝに、日暮らし、硯にむかひて、
                            </div>

                            <button type="submit">
                                <i class="cart-icon fas fa-cart-arrow-down"></i>カゴに入れる
                            </button>
                        </form>
                    </div>
                </div>
                 -->
            </div>
        </div>


        <footer>

            <div class="footer-logo">
                HAISABU Platform
            </div>

            <!-- <div class="ads">
                広告
            </div> -->

        </footer>
    </div>

    <script>
        const buttonElements = document.getElementsByTagName("button");
        Array.prototype.forEach.call(buttonElements, (anElement) => {
            anElement.addEventListener('click', (e) => {
                e.preventDefault();
                location.href = "./shopping-cart.html";
            });
        });
    </script>

    <script>
        // https://encode.work/post-645/
        $(() => {
            //ajax関数
            const ajaxGetAPI = (callBack) => {
                const baseURL = "http://localhost:3001/goods";
                const params = {
                    dataType: "json",
                    type: "GET",
                    url: baseURL
                };
                $.when($.ajax(params))
                    .done((data) => callBack(data))
                    .fail((err) => callBack(err));
            };

            // エラー処理
            ajaxGetAPI((data, error) => {
                if (error) {
                    console.error(error);
                    return;
                }
                documentScroll(data);
            });

            // APIから帰ってきたデータを描画する関数
            const scroll_countUp = (arr, num) => {
                return arr.slice(0, num).map((data, idx) => {

                    const html = `<div class="item-cell">
                        <div class="item-header">
                            <h3>${data.shop}</h3>
                            <span>${data.category}</span>
                        </div>

                        <div class="item-body">
                            <img src="img/zasshi.jpg" alt="${data.name}">
                            <h4>${data.name}</h4>
                            <hr>
                            <form>
                                <div class="clearfix menu-list">
                                    <label for="large">${data.price}円<span class="tax-text">(税込)</span></label>
                                    <select id="large" name="large">
                                        <option value="one">1冊</option>
                                        <option value="two">2冊</option>
                                        <option value="three">3冊</option>
                                        <option value="four">4冊</option>
                                        <option value="five">5冊</option>
                                        <option value="six">6冊</option>
                                        <option value="seven">7冊</option>
                                        <option value="eight">8冊</option>
                                        <option value="nine">9冊</option>
                                        <option value="ten">10冊</option>
                                    </select>
                                </div>

                                <div class="detail">
                                    ${data.description}
                                </div>

                                <button type="submit">
                                    <i class="cart-icon fas fa-cart-arrow-down"></i>カゴに入れる
                                </button>
                            </form>
                        </div>
                    </div>`
                    $(html)
                        .appendTo($('.shopping-table'));
                });

            };

            const documentScroll = (data) => {
                const baseLen = 2;

                scroll_countUp(data, baseLen);

                // 画面下までスクロールされたか判定する
                $(window).on('load scroll resize', () => {
                    const docHeight = $(document).innerHeight();
                    const windowHeight = $(window).innerHeight();
                    const pageBottom = docHeight - windowHeight;

                    if (pageBottom * 0.9 <= $(window).scrollTop()) {
                        const list = $('.item-cell').length;

                        if (list === data.length) {
                            return null;
                        } else {
                            $('.shopping-table').html("");
                            scroll_countUp(data, list + 2);
                        }
                    }
                })
            };

        })
    </script>

</body>

</html>